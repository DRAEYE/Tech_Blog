# 动力系统

## 电调

电调主要作用是根据给定的控制信号**控制电机的转速，说一千道一万，就是一个调速器而已**

无刷电调输入端是2根线，正负极电源，无刷输出3根线。

KV值的定义：转速/V。

电调的核心技术：

1. PWM波形的产生

   市面上的单片机DSP，ARM都可以实现，但这些处理器一般输出的PWM电压5V左右，其能量不足以驱动无刷直流电机。



传统的PWM模式下电调输出任务以固定的频率发送PWM信号，比如400Hz，如果下一个周期没有新的占空比的值，它将只使用旧值。如果飞控的主控制任务在一个PWM周期刚开始时计算出一个新的值，这个值需要在下一个PWM周期才会被更新输出，电调在这个新值更新后，解析这个新值也需要最差一个PWM周期的时间，所以就导致了最差两个PWM周期的延时。



OneShot模式可以使飞控的主控制任务与电调输出任务同步。

OneShot模式就是在飞控的主控制任务计算出一个新值后，电调输出任务才会更新PWM输出，并且这个值只会输出一次，即只产生一个脉冲。这样的话新值被电调正确解析的延时最差只有最长的脉宽时间。

Oneshot125是将电机输出定时器速度设置为8倍（125us-250us）。电机输出信号现在比传统的PWM（1ms-2ms）短得多，这意味着将电调正确执行飞控所发出的值所需要的时间更少。



Dshot，一种全新的电调协议。PWM和OneShot都是模拟信号，存在干扰、抖动，并且需要油门行程校准。由Flyduino(Kiss飞控的公司)联合Betaflight开发团队共同研发了Dshot数字电调协议

![img](https://pic3.zhimg.com/80/v2-21853dc1f76f2c4cd1227df49199039a_720w.jpg)

DShot数字电调协议的组成：16位 = 11位油门信号 + 1位电调信息回传 + 4位循环冗余校验

- 11位 - 2048步分辨率的油门值
- 1位 -遥测请求
- 4位 - CRC校验（检查信号的正确性）

**如何代表0和1呢？**

拿Dshot600来说，一位信号就大概是1.67us（1s/600,000），那么通过对时间的占空比代表0或者1。如果表示0：高电平占据625ns，如果表示1：高电平占据1250ns。

DShot600 - 600,000位/秒

DShot300 - 300,000位/秒

DShot150 - 150,000位/秒

**Dshot数字电调协议的优点：**

1.不再需要校准电调油门行程

2.精准的电调信号，不像PWM是模拟信号，容易在传输过程中出现的干扰以及电调解析时的偏差，并且不用油门行程校准。

3.油门分辨率是2的11次方=2048

4.速度上面，比Oneshot电调协议快太多

5.安全性，Dshot自带四位循环冗余校验（CRC）

**速度对比（全油门情况下的对比）：**

- Oneshot125 – 250 uS
- DShot150 – 106.7 uS
- Oneshot42 – 84 uS
- DShot300 – 53.3 uS
- DShot600 – 26.7 uS

**什么是DShot？**

DShot是 Digital Shot 的缩写。DShot是数字协议（相对于oneshot，oneshot125，oneshot42，multishot等）。它最初是由Felix在KISS提出的，后来被Betaflight和BLHeli_S开发团队采用。

**为什么 DShot 更好？**

要理解这一点，首先需要理解旧的模拟电调协议是如何工作的: 它们每隔几微秒就将电脉冲从飞控发送到电调。脉冲持续时间的长短（油门大小）决定了电机的功率。这种控制方案受到电噪声和电脉冲定时精度的限制。使用 DShot 数字化意味着飞控将以数字编号的形式向电调发送精确的油门值。这个数字将有一个校验值，以便从飞控发送到电调的油门值永远不会被识别错误。

**与Oneshot和Multishot相比DShot有什么优势**

•无需进行电调行程校准

•更精确的传输信号，更强大的抗干扰能力

•分辨率为2048，而其他协议分辨率为1000

•比Oneshot协议更快

•更安全，每个信号 电调都可以检测yifan损坏的数据





代码 drivers/dshot.cpp